@using INIManagerServer.Components.Models
@using INIManagerServer.Components.Services
@inject ConfigurationDraftService _configurationDraftService
@inject NavigationManager _navigationManager
@inject IJSRuntime JsRuntime

<button class="hamburger-btn">
    <i class="fas fa-bars"></i>
</button>
<div class="sidebar">
    <div class="sidebar-header">
        <i class="fas fa-rocket"></i>
        <h2>INIManager</h2>
    </div>
    <nav class="sidebar-nav">
        <a @onclick="() => Navigate(1)" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a @onclick="() => Navigate(2)" class="nav-item">
            <i class="fas fa-cogs"></i>
            <span>Configurator</span>
        </a>
        <a @onclick="() => Navigate(3)" class="nav-item">
            <i class="fas fa-sliders-h"></i>
            <span>Settings</span>
        </a>
    </nav>
</div>

@code {
    private int _id;
    Configuration _configuration = new();

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await JsRuntime.InvokeVoidAsync("initNavbar");
    }
    
    async Task Navigate(int id)
    {
        switch (id)
        {
            case 1:
                _navigationManager.NavigateTo("/");
                break;
            case 2:
                do
                {
                    do
                    {
                        _id = Random.Shared.Next(1, 10000000);
                    } while ((await _configurationDraftService.ReadConfigurationById(_id)).Id == _id);

                    var result = await _configurationDraftService.CreateConfiguration(_id);

                    if (result)
                    {
                        _navigationManager.NavigateTo($"Configurator/{_id}?from=NavMenu");
                        break;
                    }
                } while (true);
                break;
            case 3:
                _navigationManager.NavigateTo("/Settings");
                break;
            default:
                break;
        }
    }
}